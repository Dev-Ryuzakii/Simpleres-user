# Customer Endpoints Documentation

This document describes all **public customer-facing endpoints** that do not require authentication. These endpoints are used by customers when ordering through the QR code scanning system.

**Base URL:** `http://localhost:3030` (or your production URL)

**Note:** All endpoints in this document are **public** and do not require authentication tokens.

---

## How QR Code System Works

When a customer scans the QR code on a table:

1. **Admin Setup**: Admin provides a base URL (e.g., `https://your-restaurant.com`) when creating the table
2. **Automatic Generation**: System automatically:
   - Adds `/order` path if no path is provided in the base URL
   - Embeds all table data as URL query parameters
3. **QR Code Contains**: Complete URL with all table information:
   ```
   https://your-restaurant.com/order?tableId=abc-123&tableNumber=1&capacity=4&location=Main%20Hall
   ```
4. **Customer Experience**: Customer scans → Opens your website with all table data already in the URL
5. **Your Website**: Extract all data from URL parameters - **no API call needed for table info!**

**Example JavaScript:**
```javascript
// Extract table data from URL
const urlParams = new URLSearchParams(window.location.search);
const tableId = urlParams.get('tableId');
const tableNumber = urlParams.get('tableNumber');
const capacity = urlParams.get('capacity');
const location = urlParams.get('location');

// Use immediately - no API call required!
```

---

## Table of Contents

1. [Restaurant Information](#restaurant-information)
2. [Table Information](#table-information)
3. [Menu](#menu)
4. [Orders](#orders)
5. [Payments](#payments)

---

## Restaurant Information

### Get Restaurant Profile

Get basic restaurant information including name, logo, and contact details.

```http
GET /restaurant
```

**No authentication required**

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": "My Restaurant",
  "contactInfo": {
    "phone": "+1234567890",
    "email": "info@restaurant.com",
    "address": "123 Main St, City, State"
  },
  "logoUrl": "https://res.cloudinary.com/...",
  "isActive": true,
  "createdAt": "2025-01-01T00:00:00.000Z",
  "updatedAt": "2025-01-01T00:00:00.000Z"
}
```

**Use Case:** Display restaurant branding and contact information on the customer ordering website.

---

## Table Information

### Get Table Information by Table ID

Retrieve table details using the table ID. **Note:** This endpoint is optional since all table data is now embedded in the QR code URL parameters.

```http
GET /tables/info/{tableId}
```

**Parameters:**
- `tableId` (path, required): UUID of the table

**No authentication required**

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174002",
  "tableNumber": "1",
  "tableName": "Table 1",
  "capacity": 4,
  "location": "Main Hall"
}
```

**Error Responses:**
- `400 Bad Request`: Invalid table ID format
- `404 Not Found`: Table not found or inactive

**Use Case:** Optional endpoint for validation or if you need to refresh table data. The QR code now contains all table information in the URL parameters, so this endpoint may not be necessary.

**Example:**
```
QR Code URL: https://your-restaurant.com/order?tableId=abc-123&tableNumber=1&capacity=4&location=Main%20Hall

JavaScript example to extract data:
const urlParams = new URLSearchParams(window.location.search);
const tableId = urlParams.get('tableId');        // "abc-123"
const tableNumber = urlParams.get('tableNumber'); // "1"
const capacity = urlParams.get('capacity');      // "4"
const location = urlParams.get('location');      // "Main Hall"
```

**Note:** The QR code URL is automatically generated by the system. The admin provides a base URL (e.g., `https://your-restaurant.com`), and the system automatically:
- Adds `/order` path if no path is provided
- Appends all table data as query parameters

### Get Table Information by QR Code Data

Retrieve table details using the QR code data (for QR codes that contain JSON data instead of URLs).

```http
GET /tables/{qrCode}
```

**Parameters:**
- `qrCode` (path, required): URL-encoded QR code data (JSON string or URL)

**No authentication required**

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174002",
  "tableNumber": "1",
  "tableName": "Table 1",
  "qrCodeUrl": "data:image/png;base64,...",
  "qrCodeData": "https://your-restaurant.com/order?tableId=abc-123&tableNumber=1&capacity=4&location=Main%20Hall",
  "capacity": 4,
  "location": "Main Hall",
  "orderWebsiteUrl": "https://your-restaurant.com/order",
  "isActive": true,
  "createdAt": "2025-01-01T00:00:00.000Z",
  "updatedAt": "2025-01-01T00:00:00.000Z"
}
```

**Error Responses:**
- `404 Not Found`: Table not found or inactive

**Use Case:** For QR codes that contain JSON data, this endpoint can be used to retrieve full table information.

---

## Menu

### Get Public Menu

Retrieve the complete menu with categories and items. Only active categories and available items are returned.

```http
GET /menu
```

**No authentication required**

**Response:**
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174003",
    "name": "Appetizers",
    "description": "Start your meal with these delicious options",
    "displayOrder": 1,
    "isActive": true,
    "menuItems": [
      {
        "id": "123e4567-e89b-12d3-a456-426614174004",
        "name": "Spring Rolls",
        "description": "Crispy vegetable spring rolls with sweet chili sauce",
        "price": 5.99,
        "imageUrl": "https://res.cloudinary.com/...",
        "isAvailable": true,
        "preparationTime": 15,
        "categoryId": "123e4567-e89b-12d3-a456-426614174003"
      },
      {
        "id": "123e4567-e89b-12d3-a456-426614174005",
        "name": "Chicken Wings",
        "description": "Spicy buffalo wings",
        "price": 8.99,
        "imageUrl": "https://res.cloudinary.com/...",
        "isAvailable": true,
        "preparationTime": 20,
        "categoryId": "123e4567-e89b-12d3-a456-426614174003"
      }
    ]
  },
  {
    "id": "123e4567-e89b-12d3-a456-426614174006",
    "name": "Main Courses",
    "description": "Hearty main dishes",
    "displayOrder": 2,
    "isActive": true,
    "menuItems": [
      {
        "id": "123e4567-e89b-12d3-a456-426614174007",
        "name": "Grilled Salmon",
        "description": "Fresh salmon with vegetables",
        "price": 18.99,
        "imageUrl": "https://res.cloudinary.com/...",
        "isAvailable": true,
        "preparationTime": 25,
        "categoryId": "123e4567-e89b-12d3-a456-426614174006"
      }
    ]
  }
]
```

**Response Fields:**
- Categories are sorted by `displayOrder`
- Only `isActive: true` categories are included
- Only `isAvailable: true` menu items are included
- Menu items include full details including images and prices

**Use Case:** Display the complete menu on the customer ordering website, organized by categories.

---

## Orders

### Create Order

Create a new order for a table. This is the main endpoint customers use to place their orders.

```http
POST /orders
Content-Type: application/json
```

**No authentication required**

**Request Body:**
```json
{
  "tableId": "123e4567-e89b-12d3-a456-426614174002",
  "items": [
    {
      "menuItemId": "123e4567-e89b-12d3-a456-426614174004",
      "quantity": 2,
      "specialInstructions": "No onions, extra sauce"
    },
    {
      "menuItemId": "123e4567-e89b-12d3-a456-426614174007",
      "quantity": 1,
      "specialInstructions": "Well done"
    }
  ],
  "paymentMethod": "cash",
  "specialInstructions": "Please deliver quickly"
}
```

**Request Fields:**
- `tableId` (required, UUID): The table ID where the order is placed
- `items` (required, array): Array of order items
  - `menuItemId` (required, UUID): ID of the menu item
  - `quantity` (required, number): Quantity of the item
  - `specialInstructions` (optional, string): Special instructions for this item
- `paymentMethod` (required, enum): Payment method type
  - Valid values: `cash`, `pos`, `transfer`
- `specialInstructions` (optional, string): General instructions for the order

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174008",
  "orderNumber": "ORD-20250101-001",
  "tableId": "123e4567-e89b-12d3-a456-426614174002",
  "status": "pending",
  "totalAmount": 29.97,
  "paymentMethod": "cash",
  "paymentStatus": "pending",
  "specialInstructions": "Please deliver quickly",
  "items": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174009",
      "menuItemId": "123e4567-e89b-12d3-a456-426614174004",
      "menuItem": {
        "id": "123e4567-e89b-12d3-a456-426614174004",
        "name": "Spring Rolls",
        "price": 5.99
      },
      "quantity": 2,
      "price": 5.99,
      "subtotal": 11.98,
      "specialInstructions": "No onions, extra sauce"
    },
    {
      "id": "123e4567-e89b-12d3-a456-426614174010",
      "menuItemId": "123e4567-e89b-12d3-a456-426614174007",
      "menuItem": {
        "id": "123e4567-e89b-12d3-a456-426614174007",
        "name": "Grilled Salmon",
        "price": 18.99
      },
      "quantity": 1,
      "price": 18.99,
      "subtotal": 18.99,
      "specialInstructions": "Well done"
    }
  ],
  "createdAt": "2025-01-01T12:00:00.000Z",
  "updatedAt": "2025-01-01T12:00:00.000Z"
}
```

**Error Responses:**
- `400 Bad Request`: Invalid request body or missing required fields
- `404 Not Found`: Table or menu item not found

**Order Status Values:**
- `pending`: Order just created, awaiting acceptance
- `accepted`: Order accepted by kitchen/tablet
- `rejected`: Order rejected (e.g., item unavailable)
- `preparing`: Order being prepared
- `ready`: Order ready for pickup/delivery
- `completed`: Order completed

**Use Case:** Customer places an order after selecting items from the menu.

### Get Orders for Table

Retrieve all orders for a specific table. Useful for customers to see their order history.

```http
GET /orders/table/{tableId}
```

**Parameters:**
- `tableId` (path, required): UUID of the table

**No authentication required**

**Response:**
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174008",
    "orderNumber": "ORD-20250101-001",
    "tableId": "123e4567-e89b-12d3-a456-426614174002",
    "status": "preparing",
    "totalAmount": 29.97,
    "paymentMethod": "cash",
    "paymentStatus": "pending",
    "items": [
      {
        "id": "123e4567-e89b-12d3-a456-426614174009",
        "menuItem": {
          "name": "Spring Rolls",
          "price": 5.99
        },
        "quantity": 2,
        "subtotal": 11.98
      }
    ],
    "createdAt": "2025-01-01T12:00:00.000Z",
    "updatedAt": "2025-01-01T12:05:00.000Z"
  }
]
```

**Use Case:** Display order history and current order status for the table.

### Get Order by ID

Retrieve detailed information about a specific order.

```http
GET /orders/{id}
```

**Parameters:**
- `id` (path, required): UUID of the order

**No authentication required**

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174008",
  "orderNumber": "ORD-20250101-001",
  "tableId": "123e4567-e89b-12d3-a456-426614174002",
  "table": {
    "id": "123e4567-e89b-12d3-a456-426614174002",
    "tableNumber": "1",
    "location": "Main Hall"
  },
  "status": "preparing",
  "totalAmount": 29.97,
  "paymentMethod": "cash",
  "paymentStatus": "pending",
  "specialInstructions": "Please deliver quickly",
  "items": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174009",
      "menuItem": {
        "id": "123e4567-e89b-12d3-a456-426614174004",
        "name": "Spring Rolls",
        "description": "Crispy vegetable spring rolls",
        "price": 5.99,
        "imageUrl": "https://res.cloudinary.com/..."
      },
      "quantity": 2,
      "price": 5.99,
      "subtotal": 11.98,
      "specialInstructions": "No onions, extra sauce"
    }
  ],
  "createdAt": "2025-01-01T12:00:00.000Z",
  "updatedAt": "2025-01-01T12:05:00.000Z"
}
```

**Error Responses:**
- `404 Not Found`: Order not found

**Use Case:** Display detailed order information, including real-time status updates.

---

## Payments

### Get Available Payment Methods

Retrieve all active payment methods available for customers.

```http
GET /payment-methods
```

**No authentication required**

**Response:**
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174011",
    "type": "cash",
    "name": "Cash Payment",
    "isActive": true,
    "createdAt": "2025-01-01T00:00:00.000Z"
  },
  {
    "id": "123e4567-e89b-12d3-a456-426614174012",
    "type": "pos",
    "name": "POS/Card Payment",
    "isActive": true,
    "createdAt": "2025-01-01T00:00:00.000Z"
  },
  {
    "id": "123e4567-e89b-12d3-a456-426614174013",
    "type": "transfer",
    "name": "Bank Transfer",
    "bankName": "ABC Bank",
    "accountNumber": "1234567890",
    "accountName": "Restaurant Account",
    "isActive": true,
    "createdAt": "2025-01-01T00:00:00.000Z"
  }
]
```

**Payment Method Types:**
- `cash`: Cash payment
- `pos`: Point of Sale / Card payment
- `transfer`: Bank transfer payment

**Use Case:** Display available payment options to customers during checkout.

### Initiate Payment

Create a payment record for an order. This should be called after an order is created.

```http
POST /payments/initiate
Content-Type: application/json
```

**No authentication required**

**Request Body:**
```json
{
  "orderId": "123e4567-e89b-12d3-a456-426614174008",
  "paymentMethod": "transfer"
}
```

**Request Fields:**
- `orderId` (required, UUID): ID of the order to pay for
- `paymentMethod` (required, enum): Payment method type
  - Valid values: `cash`, `pos`, `transfer`

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174014",
  "orderId": "123e4567-e89b-12d3-a456-426614174008",
  "paymentMethod": "transfer",
  "status": "pending",
  "amount": 29.97,
  "createdAt": "2025-01-01T12:10:00.000Z",
  "updatedAt": "2025-01-01T12:10:00.000Z"
}
```

**Payment Status Values:**
- `pending`: Payment initiated, awaiting confirmation
- `completed`: Payment confirmed
- `failed`: Payment failed

**Error Responses:**
- `400 Bad Request`: Invalid request or order not found
- `404 Not Found`: Order not found

**Use Case:** Create a payment record when customer selects a payment method.

### Upload Transfer Receipt

Upload a receipt image for bank transfer payments. This is used when customers pay via bank transfer and need to provide proof of payment.

```http
POST /payments/transfer/upload
Content-Type: application/json
```

**No authentication required**

**Request Body:**
```json
{
  "paymentId": "123e4567-e89b-12d3-a456-426614174014",
  "receiptUrl": "https://res.cloudinary.com/your-cloud/receipt.jpg"
}
```

**Request Fields:**
- `paymentId` (required, UUID): ID of the payment record
- `receiptUrl` (required, string): URL of the uploaded receipt image

**Note:** The receipt image should be uploaded to your image hosting service (e.g., Cloudinary) first, then the URL should be sent to this endpoint.

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174014",
  "orderId": "123e4567-e89b-12d3-a456-426614174008",
  "paymentMethod": "transfer",
  "status": "pending",
  "amount": 29.97,
  "receiptImageUrl": "https://res.cloudinary.com/your-cloud/receipt.jpg",
  "updatedAt": "2025-01-01T12:15:00.000Z"
}
```

**Error Responses:**
- `400 Bad Request`: Invalid request or payment not found
- `404 Not Found`: Payment not found

**Use Case:** Customer uploads a screenshot or photo of their bank transfer receipt for verification.

---

## Complete Customer Ordering Flow

Here's a typical flow for a customer using the ordering system:

### Step 1: Scan QR Code
Customer scans the QR code on the table. The QR code contains a website URL with **all table data embedded** as URL parameters.

**How it works:**
1. Admin provides base URL: `https://your-restaurant.com` (or `https://your-restaurant.com/order`)
2. System automatically generates QR code with: `https://your-restaurant.com/order?tableId=abc-123&tableNumber=1&capacity=4&location=Main%20Hall`
3. Customer scans → Opens website with all data in URL

**All table information is available directly from the URL parameters:**
- `tableId`: Unique table identifier (UUID)
- `tableNumber`: Table number (string)
- `tableName`: Table name (if set, optional)
- `capacity`: Table capacity (if set, optional)
- `location`: Table location (if set, optional)

**Extract data from URL in JavaScript:**
```javascript
// Get all URL parameters
const urlParams = new URLSearchParams(window.location.search);

// Extract table data
const tableId = urlParams.get('tableId');
const tableNumber = urlParams.get('tableNumber');
const tableName = urlParams.get('tableName');
const capacity = parseInt(urlParams.get('capacity') || '0');
const location = urlParams.get('location');

// Use the data immediately - no API call needed!
console.log(`Table ${tableNumber} at ${location}`);
```

**No API call needed** - the website can extract all data from the URL!

### Step 2: Extract Data from URL (Optional)
If you need to validate or refresh table data, you can optionally call:
```http
GET /tables/info/{tableId}
```
But this is **not required** since all data is already in the URL.

### Step 3: Display Menu
```http
GET /menu
```
Website displays the complete menu organized by categories.

### Step 4: Get Payment Methods
```http
GET /payment-methods
```
Website shows available payment options.

### Step 5: Customer Places Order
```http
POST /orders
```
Customer selects items and places the order.

### Step 6: Initiate Payment
```http
POST /payments/initiate
```
Payment record is created based on selected payment method.

### Step 7: Upload Receipt (if transfer payment)
```http
POST /payments/transfer/upload
```
If customer chose bank transfer, they upload the receipt.

### Step 8: Check Order Status
```http
GET /orders/{orderId}
```
Customer can check the status of their order in real-time.

### Step 9: View Order History
```http
GET /orders/table/{tableId}
```
Customer can view all orders for their table.

---

## Error Handling

All endpoints follow standard HTTP status codes:

- `200 OK`: Request successful
- `201 Created`: Resource created successfully
- `400 Bad Request`: Invalid request data
- `404 Not Found`: Resource not found
- `500 Internal Server Error`: Server error

**Error Response Format:**
```json
{
  "statusCode": 400,
  "message": "Validation failed",
  "error": "Bad Request"
}
```

---

## Rate Limiting

Currently, there are no rate limits on public endpoints. However, it's recommended to implement rate limiting in production to prevent abuse.

---

## CORS

If you're building a web application, ensure your backend allows CORS requests from your frontend domain. The server should be configured to accept requests from your customer-facing website.

---

## Notes

1. **No Authentication Required**: All endpoints in this document are public and do not require authentication tokens.

2. **Extracting Table Data from URL**: When customers scan the QR code, all table data is embedded in the URL parameters. Extract it using JavaScript:
   ```javascript
   // Example URL: https://your-restaurant.com/order?tableId=abc-123&tableNumber=1&capacity=4&location=Main%20Hall
   
   const urlParams = new URLSearchParams(window.location.search);
   const tableId = urlParams.get('tableId');        // "abc-123"
   const tableNumber = urlParams.get('tableNumber'); // "1"
   const capacity = urlParams.get('capacity');      // "4"
   const location = urlParams.get('location');      // "Main Hall"
   const tableName = urlParams.get('tableName');    // null or "Table 1"
   ```
   
   **Note:** The QR code URL is automatically generated by the system. The admin only needs to provide the base URL (e.g., `https://your-restaurant.com`), and the system automatically:
   - Adds `/order` path if no path is provided
   - Appends all table data as query parameters

3. **Order Status Updates**: Order statuses are updated by kitchen staff/tablets. Customers can poll the `GET /orders/{id}` endpoint to get real-time updates.

4. **Payment Confirmation**: Payment confirmations are handled by restaurant staff via tablet endpoints (not documented here as they require authentication).

5. **Image URLs**: Menu item images and receipt images are hosted on Cloudinary and returned as full URLs.

---

## Support

For issues or questions about these endpoints, contact the restaurant management team or refer to the Swagger documentation at:
```
http://localhost:3030/api
```

